num_trials = 1000000

num_fit_samps = 100000
num_bid_pts = 500
num_mus = 500

kinds_params_list = [
  [[0.01816569718524226, -0.5728236241103661, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.7348732392940399, -0.7527720952028175, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.27275771834622226, -0.6888514958270003, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.3130850449295427, -0.7125898127791651, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [0.37451350256927757, -0.5624264041431577, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7]],
  [[0.029732493175854007, -0.7570671566040863, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.19083488857743575, -0.6070343514320976, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7]],
  [[-0.24916334124326808, -0.6676871668241016, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [0.24581315833904138, -0.6197193949052684, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [0.1654422252039744, -0.5280777511367193, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.3558170605600877, -0.6952980639558511, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [0.23008858081263805, -0.5688275178131389, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.3382340431879971, -0.7236659758199254, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.1471726948932112, -0.6549163813051521, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.12268266740732625, -0.6669288014948457, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.34189918593974744, -0.7973375491688813, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.19558233930472302, -0.6037153431521511, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7]],
  [[-0.3279532807407665, -0.7521348577358058, 1.4230249470757705, 0.17888543819998318, 0.4444444444444445, 0.7], [0.7958705315460941, -0.5060536017343737, 1.4230249470757705, 0.17888543819998318, 0.4444444444444445, 0.7], [0.23038996131298164, -0.6140392195899306, 1.4230249470757705, 0.17888543819998318, 0.4444444444444445, 0.7], [0.042849130890505883, -0.6693047321131622, 1.4230249470757705, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.09026163034494783, -0.4937318603831803, 1.4230249470757705, 0.17888543819998318, 0.4444444444444445, 0.7]],
  [[-0.07625651499010597, -0.5735728666577641, 0.4743416490252569, 0.17888543819998318, 0.4444444444444445, 0.7], [0.13848731476260756, -0.44013738928322815, 0.4743416490252569, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.17626656642620608, -0.6859893312849895, 0.4743416490252569, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.0038854352930516346, -0.5618712006815668, 0.4743416490252569, 0.17888543819998318, 0.4444444444444445, 0.7], [0.005069570864670606, -0.6183391514789875, 0.4743416490252569, 0.17888543819998318, 0.4444444444444445, 0.7]],
  [[-0.15748376521018065, -0.481711352472551, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.018525328119961063, -0.347937570427031, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [0.07449936731869342, -0.2699899435644048, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.2661898406920269, -0.5616411674756313, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [0.12629025461988708, -0.3165931733299165, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7]],
  [[-0.17432565420216314, -1.0156692141959665, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.14033083882871616, -0.9477830216292848, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.31324699444986054, -1.112352955326828, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.5142047154531971, -1.1356085867705072, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7], [-0.18511300853832494, -1.0450718057194892, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.7]],
  [[0.03854494652176685, -0.62, 0.9486832980505138, 0.0, 0.4444444444444445, 0.7], [-0.097323229873333, -0.62, 0.9486832980505138, 0.0, 0.4444444444444445, 0.7], [-0.43492155815861955, -0.62, 0.9486832980505138, 0.0, 0.4444444444444445, 0.7], [0.2962808537143916, -0.62, 0.9486832980505138, 0.0, 0.4444444444444445, 0.7], [0.2536125079625559, -0.62, 0.9486832980505138, 0.0, 0.4444444444444445, 0.7]],
  [[-0.6506614924058678, -1.2690521615577772, 0.9486832980505138, 0.8944271909999159, 0.4444444444444445, 0.7], [-0.23069741582535538, -1.1631470956867371, 0.9486832980505138, 0.8944271909999159, 0.4444444444444445, 0.7], [-0.000476952926513563, -0.7583915707021918, 0.9486832980505138, 0.8944271909999159, 0.4444444444444445, 0.7], [-0.10250923240308306, -0.807161846184887, 0.9486832980505138, 0.8944271909999159, 0.4444444444444445, 0.7], [0.32400496020126146, -0.2689386011742036, 0.9486832980505138, 0.8944271909999159, 0.4444444444444445, 0.7]],
  [[0.4773478143142056, -0.7217288197759072, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, -0.5], [0.6969001203090446, -0.7785386058182283, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, -0.5], [-0.03481421600221182, -0.5276512147279855, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, -0.5], [-0.24642391240216607, -0.6121141344547647, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, -0.5], [0.11710753065308567, -0.669402177734943, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, -0.5]],
  [[-0.7079518747658635, -0.7507057458188536, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.0], [-0.09760552538093227, -0.49399173467513413, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.0], [-0.01852049238039718, -0.6595096280576288, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.0], [-0.2270471026115321, -0.6337041109352874, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.0], [0.19678514182336504, -0.6238419591855966, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 0.0]],
  [[0.1528487137459307, -0.5767678538768143, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 1.0], [-0.0700757774792963, -0.6398204227913701, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 1.0], [-0.5328831634123234, -0.7707221165876565, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 1.0], [-0.02405319336382206, -0.62680327245607, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 1.0], [0.7529693337812312, -0.4070281140211638, 0.9486832980505138, 0.17888543819998318, 0.4444444444444445, 1.0]],
  [[-0.07661333538223845, -0.8143187232145037, 0.7071067811865476, 0.11547005383792515, 0.5, 0.7], [0.2139235656592542, -0.6728941037173476, 0.7071067811865476, 0.11547005383792515, 0.5, 0.7], [-0.1765889580381974, -0.5823156734625203, 0.7071067811865476, 0.11547005383792515, 0.5, 0.7], [-0.02784281781754924, -0.5559817856738619, 0.7071067811865476, 0.11547005383792515, 0.5, 0.7], [0.4428116166291949, -0.37252175646438235, 0.7071067811865476, 0.11547005383792515, 0.5, 0.7]],
  [[0.3864477230824654, -0.46099055854453164, 0.7071067811865476, 0.06030226891555273, 0.1, 0.7], [0.18207517262393255, -0.7339726177430151, 0.7071067811865476, 0.06030226891555273, 0.1, 0.7], [-0.1598585784662104, -0.5253259662327643, 0.7071067811865476, 0.06030226891555273, 0.1, 0.7], [0.29869435325105387, -0.4662556429779009, 0.7071067811865476, 0.06030226891555273, 0.1, 0.7], [0.5828663147487039, -0.356356410157104, 0.7071067811865476, 0.06030226891555273, 0.1, 0.7]],
  [[0.18056011907839908, -0.5764480853839361, 0.9486832980505138, 0.14142135623730953, 0.11111111111111112, 0.7], [0.01891498636498904, -0.6456937806504337, 0.9486832980505138, 0.14142135623730953, 0.11111111111111112, 0.7], [-0.2488765953392285, -0.7464292037184248, 0.9486832980505138, 0.14142135623730953, 0.11111111111111112, 0.7], [-0.4728290928432755, -0.7706739810281591, 0.9486832980505138, 0.14142135623730953, 0.11111111111111112, 0.7], [0.42160897718191326, -0.35396180870943184, 0.9486832980505138, 0.14142135623730953, 0.11111111111111112, 0.7]],
  [[0.22385209965160122, -0.6539948389770921, 0.9486832980505138, 0.18708286933869708, 0.7777777777777777, 0.7], [-0.2752218086638565, -0.6662810482580036, 0.9486832980505138, 0.18708286933869708, 0.7777777777777777, 0.7], [-0.04330770986397227, -0.6905005852818998, 0.9486832980505138, 0.18708286933869708, 0.7777777777777777, 0.7], [0.7539238715315233, -0.5550617170126945, 0.9486832980505138, 0.18708286933869708, 0.7777777777777777, 0.7], [-0.022653026645249125, -0.5238228066747825, 0.9486832980505138, 0.18708286933869708, 0.7777777777777777, 0.7]],
  ]

ns_params_list = [
   5,
   2,
   10,
   5,
   5,
   5,
   5,
   5,
   5,
   5,
   5,
   5,
   5,
   5,
   5,
   5,
  ]

ns_list = [
   [1, 1, 1, 1, 1],
   [1, 1],
   [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
   [1, 1, 1, 1, 1],
   [1, 1, 1, 1, 1],
   [1, 1, 1, 1, 1],
   [1, 1, 1, 1, 1],
   [1, 1, 1, 1, 1],
   [1, 1, 1, 1, 1],
   [1, 1, 1, 1, 1],
   [1, 1, 1, 1, 1],
   [1, 1, 1, 1, 1],
   [1, 1, 1, 1, 1],
   [1, 1, 1, 1, 1],
   [1, 1, 1, 1, 1],
   [1, 1, 1, 1, 1],
  ]

import numpy as np
import matplotlib.pyplot as plt

results_list = [
  # simul_welfare, simul_revenue, descend_welfare, descend_revenue, opt_welfare, frac_inspect_simul, never_inspect_welfare, never_inspect_revenue
  [2.3254925124470476, 1.0698897566412187, 2.3978845154285557, 1.9982882096413523, 2.398241346175916, 0.14659419999999332, 0.26839840000000187, 0.26769539999999387, 2.2715096306237754, 1.1028962594117613],
  [1.4522500786208266, 0.44498133694715397, 1.4365574333349775, 0.8676433461464786, 1.469724829757523, 0.24058400000000885, 0.5537315000000351, 0.5614774999999884, 1.4357499811634271, 0.4593145112024434],
  [3.038168074373541, 1.748222765057084, 3.2062926700824814, 2.7445766811934185, 3.206330909590963, 0.10509609999999751, 0.16559319999999944, 0.16550989999999952, 2.895300502908459, 1.773573152703854],
  [9.176571802341378, 2.7960200896134775, 9.361950214960283, 4.163959423667053, 9.36609388964318, 0.39263619999999133, 0.43001520000001575, 0.42775739999999074, 8.02645153244415, 3.2819813908753996],
  [0.9148979518847303, 0.6446161646840266, 0.9173004510007362, 0.8156910971513328, 0.9173198713850468, 0.0020106000000000616, 0.20489599999999863, 0.20488539999999864, 0.9148582313203024, 0.6446137465701258],
  [2.1069685151471513, 1.0539860567161248, 2.1786091388581017, 1.593376522082889, 2.1786940513549458, 0.0985640000000041, 0.25624640000000637, 0.2561059999999928, 2.0733564613236304, 1.0724284023501247],
  [1.9770711147143731, 1.0433900571984098, 2.0623025678664852, 1.430195041232372, 2.0623634873488905, 0.1977059999999928, 0.307153400000019, 0.3070126000000101, 1.8942262045450589, 1.072599351062952],
  [2.7985497426782215, 1.3800041130651923, 2.8994694452927434, 2.3758433063881936, 2.8996257147611506, 0.1926563999999883, 0.29410839999999333, 0.2938094000000112, 2.6819805810732795, 1.433908947581387],
  [1.8381805120395802, 0.9977119416018403, 1.9078164344991537, 1.558037098741816, 1.907837163077603, 0.1791283999999946, 0.29645479999998137, 0.2962982000000004, 1.7834542567319474, 1.0031936194443563],
  [3.965063783832023, 1.8408527699138177, 4.080792612259142, 3.0608386854562823, 4.081644814410953, 0.2653784000000004, 0.3221219999999907, 0.3209208000000059, 3.7278190519565806, 1.94966773983551],
  [2.2649226201738477, 1.0794520600611577, 2.3362831848474577, 1.9272735795955718, 2.3365211731675193, 0.15902379999999794, 0.2759996000000055, 0.275620800000015, 2.190979367642945, 1.1174760668871535],
  [3.2856643076001104, 1.465722492406014, 3.386010501612099, 2.608096911572085, 3.3869150634975558, 0.17723899999999643, 0.2808935999999959, 0.2797600000000133, 3.1969955888455766, 1.51835535595843],
  [1.888803973746858, 1.0932737401064991, 1.9290874015883526, 1.6475123950653763, 1.9292000196401726, 0.05680420000000101, 0.23542320000001302, 0.2352389999999988, 1.8820881909267617, 1.097936668554685],
  [1.8534077108548315, 1.3249996147500795, 1.966661238984511, 1.769253426168873, 1.9667091774813403, 0.18431240000000798, 0.31550959999999817, 0.3150336000000022, 1.7736394539403781, 1.3415029553897677],
  [2.145262719621882, 1.2853524591745695, 2.2987321142420085, 1.7165802078487162, 2.2993325139537752, 0.2928601999999952, 0.37772659999999997, 0.3789447999999953, 1.9378881611314975, 1.3196768468711717],
  [3.906513153186365, 1.624823988588158, 3.9533686669198747, 2.6540451512219487, 3.956351505546864, 0.08132479999999853, 0.22968360000000407, 0.22905100000000095, 3.8914469484129204, 1.637267347877985],
  ]

max_std_error = 0.019634711674732564

std_errors = [
  [0.002901340890895132, 0.0007378051819022576, 0.002006026751179387, 0.0015192759080905286, 0.0020059775593862976, 0.00013836487874890478, 0.00011326354976810557, 0.00011272207204050725, 0.0015064474115441952, 0.0006284496962677184],
  [0.0020043168141272573, 0.0004761995628059267, 0.0014076229459105785, 0.00068443994036037, 0.0014181787592640147, 0.00028011143747875796, 0.00015485057276758558, 0.00016779390676822722, 0.0011206099808261645, 0.0004584422755266641],
  [0.0033694656214116087, 0.001043718132888425, 0.0021812484866206524, 0.0015846990399468294, 0.0021812482633893314, 9.371301162015185e-05, 8.417718930660062e-05, 8.412698781805876e-05, 0.0015398271626386071, 0.0007335726712206852],
  [0.019634711674732564, 0.003283027372988427, 0.015169899226826948, 0.003188778119571891, 0.015171214327279988, 0.00020375832735624794, 0.00019392144124486392, 0.00019363182651238072, 0.007693321484199946, 0.002349902270102408],
  [0.0003182167370068621, 0.00018972392393886645, 0.00031190919721429727, 0.00024005764027846798, 0.00031190984279289474, 1.9997947083585464e-05, 3.122227023824752e-05, 3.11873987291966e-05, 0.0003051627842539376, 0.00018960536616455058],
  [0.002592383023171016, 0.000725911043541452, 0.0017113794093297227, 0.0010124223815787604, 0.001711375729186519, 0.00013244634931184492, 0.0001041504360737551, 0.00010399869027890461, 0.001333485834607631, 0.0006267451096779742],
  [0.002268158002126163, 0.0006881922793205093, 0.0015266257433098904, 0.0007240081293337418, 0.0015266367977240334, 0.00017632483845008703, 0.00014329176320001266, 0.00014318004030508137, 0.0010851207648804669, 0.000518944682515511],
  [0.0032521649893001926, 0.0009634996636073496, 0.0023200506864375333, 0.00165879394621833, 0.002320035721804662, 0.00016828529305610833, 0.00013180692858308357, 0.00013160278792994346, 0.0016171746755877896, 0.0007638274151461126],
  [0.0021196903167341663, 0.0006219318984776905, 0.0012894220097572314, 0.0008850045424013314, 0.0012894152667864177, 0.0001687028297749777, 0.00013882626131136205, 0.00013868120243650683, 0.0010318005699129053, 0.00047035215776520655],
  [0.0044096294705725176, 0.001302136600105128, 0.0034291983962935263, 0.001999167898776394, 0.0034292630159295126, 0.00017507511377901885, 0.00014683105487381796, 0.0001461851616870267, 0.0022520501046409632, 0.0010035169441267359],
  [0.002722415602062191, 0.0007755128157730304, 0.0019223475496939258, 0.0014358334069536217, 0.0019223244212149986, 0.0001560806695101442, 0.00011902972304392865, 0.00011871743217063558, 0.001388844283153184, 0.0006470529545059821],
  [0.004088695278902476, 0.0009708690933913095, 0.0028604469346234685, 0.0018374454083695418, 0.002860399326166621, 0.0001344901296251705, 0.0001238628306678026, 0.00012320339921884272, 0.0021252610966469567, 0.0008055519123688858],
  [0.0013949829110533826, 0.0005074317991051781, 0.0010969968901679502, 0.0008184623969572331, 0.0010969904229045006, 0.00010147459366488441, 8.311632697661608e-05, 8.29097084364642e-05, 0.0009553377464557222, 0.0004806926652748325],
  [0.0017326998347619174, 0.00040522893184787484, 0.0006333544010149147, 0.0004911796397738203, 0.0006333684573442497, 0.00011586195505959933, 0.00015450448595259543, 0.0001542644958134431, 0.00041764615431964553, 0.0002642052509882108],
  [0.0031733478700701943, 0.0007772459540593317, 0.001175415022893837, 0.0007609120988515581, 0.0011751656403444883, 0.00015585277522728723, 0.00018536809330024965, 0.00018645233524264155, 0.0006298541759639165, 0.0003615967411241063],
  [0.004132227923573531, 0.0011820229021673896, 0.0037806188043446954, 0.001880605363352832, 0.0037807286511911398, 0.00011329064277216134, 7.584411409839005e-05, 7.507333105041197e-05, 0.0033669013665348665, 0.0011457723026544945],
  ]



print("Welfare")
print("-------")
print("#   simul (std err)   descending (std err)   first-best (std err)   |   never-inspect (std err)")
for i,res in enumerate(results_list):
  print("%2d   %7.3f (%5.3f)   %7.3f (%5.3f)   %7.3f (%5.3f)   |   %7.3f (%5.3f)"
        % (i+1, res[0], std_errors[i][0], res[2], std_errors[i][2], res[4], std_errors[i][4], res[8], std_errors[i][8]))

print("")
print("Welfare as percent of first-best")
print("--------------------------------")
print("#   simul   descending   |   never-inspect")
for i,res in enumerate(results_list):
  opt = res[4]
  if opt == 0.0:
    print("-----------")
  else:
    print("%2d   %7.2f   %7.2f   |   %7.2f"
          % (i+1, 100*res[0]/opt, 100*res[2]/opt, 100*res[8]/opt))

print("")
print("Revenue")
print("-------")
print("#   simul (std err)   descending (std err)   |   never-inspect (std err)")
for i,res in enumerate(results_list):
   print("%2d   %7.3f (%5.3f)   %7.3f (%5.3f)   |   %7.3f (%5.3f)"
         % (i+1, res[1], std_errors[i][1], res[3], std_errors[i][3], res[9], std_errors[i][9]))

print("")
print("Revenue as percent of descending")
print("--------------------------------")
print("#   simul   |   never-inspect")
for i,res in enumerate(results_list):
  desc = res[3]
  if desc == 0.0:
    print("---------")
  else:
    print("%2d   %7.3f   |   %7.3f"
          % (i+1, 100*res[1]/desc, 100*res[9]/desc))

print("")
print("Percent of bidders inspecting")
print("-----------------------------")
print("#   simul (std err)   descending (std err)   opt (std err)")
for i,res in enumerate(results_list):
  print("%2d   %5.2f (%5.2f)   %5.2f (%5.2f)   %5.2f (%5.2f)"
        % (i+1, 100*res[5], 100*std_errors[i][5], 100*res[6], 100*std_errors[i][6], 100*res[7], 100*std_errors[i][7]))


width = 0.27
inds = np.arange(len(results_list))
one_inds = np.arange(1, len(results_list)+1)

## welfare plot
ax = plt.figure()
simul = plt.bar(one_inds, [r[0] for r in results_list], width, yerr=[s[0] for s in std_errors], color='green')
descend = plt.bar(one_inds + width, [r[2] for r in results_list], width, yerr=[s[2] for s in std_errors], color='blue')
opt = plt.bar(one_inds + 2*width, [r[4] for r in results_list], width, yerr=[s[4] for s in std_errors], color='red')
plt.ylabel("welfare")
plt.xlabel("parameter set")
plt.legend([simul[0], descend[0], opt[0]], ["Simultaneous", "Descending", "Opt"])
plt.xticks(one_inds)
plt.title("Welfare")

## revenue plot
ax = plt.figure()
simul = plt.bar(one_inds, [r[1] for r in results_list], width, yerr=[s[1] for s in std_errors], color='green')
descend = plt.bar(one_inds + width, [r[3] for r in results_list], width, yerr=[s[3] for s in std_errors], color='blue')
plt.ylabel("revenue")
plt.xlabel("parameter set")
plt.legend([simul[0], descend[0]], ["Simultaneous", "Descending"])
plt.xticks(one_inds)
plt.title("Revenue")

plt.show()
